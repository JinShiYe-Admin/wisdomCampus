<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/utils/pullToRefresh.css" />
		<link href="../../css/classRoom/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/classRoom/mui.poppicker.css" rel="stylesheet" />
		<style>
			body {
				background: #fff;
			}
			
			.mui-segmented-control {
				border: 0px;
				background: #F0F0F0;
			}
			
			.mui-segmented-control .mui-control-item {
				color: #0D0D0D;
				border: 0px;
			}
			
			.mui-segmented-control .mui-control-item.mui-active {
				color: #0D0D0D;
				background-color: transparent;
			}
			
			.mui-segmented-control .mui-control-item span {
				font-size: 13px;
				padding: 0 0 0 5px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color:#63BBFF;" id="actionHead">
			<a @click="muiback" class="mui-icon mui-icon-left-nav mui-pull-left" style="color: white;"></a>
			<h1 class="mui-title" style="color: white;">学生行为</h1>
			<a href="#topPopover" class="mui-icon mui-icon-more mui-pull-right" style="color: white;font-size: 25px;"></a>
		</header>
		<div class="mui-content" id="selectTitle" style="position: fixed;z-index: 8;">
			<div class="mui-segmented-control">
				<a class="mui-control-item" href="javaScript:void(0)" @click="selectGrade()"><span>{{grade}}</span><span class="mui-icon mui-icon-arrowdown"></span></a>
				<a class="mui-control-item" href="javaScript:void(0)" @click="selectClass()"><span>{{classes}}</span><span class="mui-icon mui-icon-arrowdown"></span></a>
				<a class="mui-control-item" href="javaScript:void(0)" @click="selectStudent()"><span>{{student}}</span><span class="mui-icon mui-icon-arrowdown"></span></a>
				<a class="mui-control-item" href="javaScript:void(0)" @click="selectTh()"><span>{{th}}</span><span class="mui-icon mui-icon-arrowdown"></span></a>
			</div>
		</div>
		<div class="mui-content mui-fullscreen" id="actionArrayData" style="background: white;margin-top: 85px;z-index:0;">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media" v-for="actionModel in actionArray" @tap="clickAction(actionModel)">
							<a href="javascript:;">
								<div class="mui-media-body" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;font-size: 16px;">
									{{actionModel.titleName}}
								</div>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div id="topPopover" class="mui-popover" style="width: 100px;">
			<ul class="mui-table-view">
				<li @click='clickPop(popModel)' class="mui-table-view-cell" v-for='popModel in popArray'>
					<a href="#">{{popModel.popName}}</a>
				</li>
			</ul>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/classRoom/mui.picker.min.js"></script>
		<script src="../../js/classRoom/mui.poppicker.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script src='../../js/lib/vconsole/vconsole.min.js'></script>
		<script src="../../js/lib/jquery.js"></script>
		<script src="../../js/utils/mui.pullToRefresh.js"></script>
		<script src="../../js/utils/mui.pullToRefresh.material.js"></script>

		<!--加密-->
		<script src="../../js/lib/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/lib/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/lib/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/RSAEncrypt.js" type="text/javascript" charset="utf-8"></script>

		<script src='../../js/lib/crypto-js/require.js'></script>
		<script src='../../js/utils/signHmacSHA1.js'></script>
		<script src="../../js/publicProtocol.js"></script>
		<script src='../../js/utils/sortSign.js'></script>
		<script src="../../js/utils/storageKeyName.js"></script>
		<script src="../../js/utils/store.js"></script>
		<script src="../../js/utils/utils.js"></script>
		<script src="../../js/utils/storageutil.js"></script>
		<script src='../../js/utils/events.js'></script>
		<script src="../../js/studentManage/studentManagePermission.js"></script>
		<script type="text/javascript">
			var $ = mui.init()
			var pageIndex = 1; //请求数据页面
			var totalPageCount; //总页码
			var flagRef = 0; //是刷新0，还是加载更多1
			mui.plusReady(function() {
				getTnewsCollList(pageIndex);
				//				studentMP.getStudentManagePermission(1, 1, 1, function(array) {
				//					console.log('array:' + JSON.stringify(array));
				//				});
				//2.考勤详情
				var tempData = {
					id: 50 //通知ID
				}
				getAttendanceDetail(tempData, function function_name(data) {
					console.log('data:' + JSON.stringify(data));
					if(data.RspCode == 0) {

					} else {
						mui.toast(data.RspTxt);
					}
				});
			});
			var actionHead = new Vue({
				el: "#actionHead",
				data: {

				},
				methods: {
					muiback: function() {
						console.log('clickHomeworkModel:');
						mui.back();
					}
				}
			});

			var actionArrayData = new Vue({
				el: "#actionArrayData",
				data: {
					actionArray: []
				},
				methods: {
					clickAction: function() {
						utils.mOpenWithData("../../html/studentManage/student-actionDetail.html", {});
					}
				}
			});
			var topPopover = new Vue({
				el: "#topPopover",
				data: {
					popArray: [{
						popName: '添加',
						popId: 0
					}, {
						popName: '统计报表',
						popId: 1
					}]
				},
				methods: {
					clickPop: function(model) {
						console.log('clickPop:' + JSON.stringify(model));
						mui('#topPopover').popover('hide');
					}
				}
			});

			var selectTitle = new Vue({
				el: "#selectTitle",
				data: {
					grade: '全部年级',
					classes: '全部班级',
					student: '全部学生',
					th: '谈话状态',
					list: [{
							value: '1',
							text: '全部年级',
							children: [{
								value: "10",
								text: "全部班级",
								children: [{
									value: "100",
									text: "全部学生"
								}]
							}]
						},
						{
							value: '2',
							text: '初中一年级',
							children: [{
								value: "10",
								text: "10111班",
								children: [{
									value: "101",
									text: "11张三"
								}, {
									value: "102",
									text: "11李四"
								}]
							}, {
								value: "20",
								text: "二班",
								children: [{
									value: "201",
									text: "12李四"
								}, {
									value: "202",
									text: "11王五"
								}]
							}]
						},
						{
							value: '3',
							text: '二年级',
							children: [{
								value: "10",
								text: "一班",
								children: [{
									value: "101",
									text: "21张三"
								}, {
									value: "102",
									text: "21李四"
								}]
							}, {
								value: "20",
								text: "二班",
								children: [{
									value: "201",
									text: "22李四"
								}, {
									value: "202",
									text: "22王五"
								}]
							}]
						}
					],
					thList: [{
							value: '1',
							text: '全部状态'
						},
						{
							value: '2',
							text: '已谈话'
						},
						{
							value: '3',
							text: '未谈话'
						}
					]
				},
				methods: {
					selectGrade: function() {
						var userPicker = new $.PopPicker({
							layer: 3
						});
						userPicker.setData(selectTitle.list);
						userPicker.show(function(items) {
							selectTitle.grade = _getParam(items[0], 'text');
							selectTitle.classes = _getParam(items[1], 'text');
							selectTitle.student = _getParam(items[2], 'text');
							console.log("你选择的城市是:" + _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text'));
						});
					},
					selectClass: function() {
						this.$options.methods.selectGrade();
					},
					selectStudent: function() {
						this.$options.methods.selectGrade();
					},
					selectTh: function() {
						var obj = this;
						var userPicker = new $.PopPicker({
							layer: 1
						});
						userPicker.setData(this.thList);
						userPicker.show(function(items) {
							obj.th = _getParam(items[0], 'text')
							console.log(JSON.stringify(items[0]));
						});
					}
				}
			});
			var _getParam = function(obj, param) {
				return obj[param] || '';
			}

			//阻尼系数、初始化刷新加载更多
			var deceleration = mui.os.ios ? 0.003 : 0.0009;
			mui('.mui-scroll-wrapper').scroll({
				bounce: false,
				indicators: true, //是否显示滚动条
				deceleration: deceleration
			});

			//上拉下拉注册
			mui(".mui-scroll-wrapper .mui-scroll").pullToRefresh({
				down: {
					callback: function() {
						var self = this;
						//console.log("下拉刷新");
						pageIndex = 1;
						flagRef = 0;
						//54.科教频道_个人收藏列表
						getTnewsCollList(pageIndex);
						setTimeout(function() {
							//结束下拉刷新
							self.endPullDownToRefresh();
						}, 1000);
					}
				},
				up: {
					callback: function() {
						var self = this;
						//console.log("上拉加载更多");
						flagRef = 1;
						if(pageIndex <= totalPageCount) {
							//54.科教频道_个人收藏列表
							getTnewsCollList(pageIndex);
							setTimeout(function() {
								//结束下拉刷新
								self.endPullUpToRefresh();
								if(mui(".mui-table-view-cell").length < 10) {
									mui(".mui-pull-loading")[0].innerHTML = "";
								}
							}, 1000);
						} else {
							//结束下拉刷新
							self.endPullUpToRefresh();
							mui(".mui-pull-loading")[0].innerHTML = "没有更多了";
						}
					}
				}
			});
			//54.科教频道_个人收藏列表
			function getTnewsCollList(index) {
				var tempArray = [];
				for(var i = 0; i < 10; i++) {
					var tempValue = (index - 1) * 10 + i;
					var tempModel = {
						titleName: 'index:' + tempValue
					}
					tempArray.push(tempModel);
				}
				//总页数
				totalPageCount = 20;
				pageIndex++;
				if(flagRef == 0) { //刷新
					actionArrayData.actionArray = tempArray;
				} else { //加载更多
					//合并数组
					actionArrayData.actionArray = actionArrayData.actionArray.concat(tempArray);
				}
				//需要加密的数据
				//					var comData = {
				//						top: '10', //每页行数，
				//						vvl1: index //页码,获取第几页
				//					};
				//					// 等待的对话框
				//					var wd = events.showWaiting();
				//					//54.科教频道_个人收藏列表
				//					postDataPro_PostTnewsCollList(comData, wd, function(data) {
				//						wd.close();
				//						console.log('54.科教频道_个人收藏列表:' + JSON.stringify(data));
				//						if(data.RspCode == 0) {
				//							//总页数
				//							totalPageCount = data.RspData.pg.PageCount;
				//							pageIndex++;
				//							if(flagRef == 0) { //刷新
				//								actionArrayData.actionArray = data.RspData.dt;
				//							} else { //加载更多
				//								//合并数组
				//								actionArrayData.actionArray = actionArrayData.actionArray.concat(data.RspData.dt);
				//							}
				//						} else {
				////							mui.toast(data.RspTxt);
				//						}
				//					});
			};
		</script>
	</body>

</html>